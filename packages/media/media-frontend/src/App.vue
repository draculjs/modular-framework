<template>
  <v-app>
    <layout :menu="menu">
      <template v-slot:toolbar-left>
        <logo-toolbar></logo-toolbar>
        <title-toolbar></title-toolbar>
      </template>

      <template v-slot:toolbar-right>
        <dashboard-button/>
        <app-bar-user-menu/>
      </template>


      <router-view></router-view>
      <error-snackbar></error-snackbar>
    </layout>
  </v-app>
</template>

<script>

import Layout from "./layout/Layout";
import menuConfig from './menu-config'
import {DashboardButton, AppBarUserMenu} from '@dracul/user-frontend'
import {LogoToolbar, TitleToolbar} from '@dracul/customize-frontend'
import ErrorSnackbar from "./modules/base/components/ErrorSnackbar";
import {mapGetters} from 'vuex'

export default {
  name: 'App',
  components: {
    Layout, DashboardButton, AppBarUserMenu, LogoToolbar, TitleToolbar, ErrorSnackbar
  },
  data() {
    return {
      menu: menuConfig
    }
  },
  mounted() {
    this.$store.dispatch('checkAuth')
  },
  watch: {
    '$store.state.user.access_token': {
      handler(val) {
        if (val === null && this.$route.name != 'login') {
          this.$router.push({name: 'login'})
        }
      }
    }
  },
  computed: {
    ...mapGetters(['me']),
    getUserId() {
      return this.me ? this.me.id : null
    }
  }
};
</script>
